# 需求文档

## 介绍

本规格定义了构建语义增强共词网络分析管线的需求。该系统旨在处理多份政策/法规类文档（按州/地区分组，含英文与中文），通过"统计学共现网络（baseline）→ 语义增强（semantic enhancement）→ 图融合与对比分析"的主线，构建一个可复现、可解释、可扩展的文本—图分析管线。系统以TOC分段后的全文文本为输入，将"词/词组"作为节点、将同一文本窗口内的共现关系作为边，先生成跨全部文档的"总图（global graph）"，再在其基础上按州/文档子集进行激活与子图分析。

## 术语表

- **总图（Global_Graph）**: 从所有州/地区文档构建的全局共现网络
- **州级子图（State_Subgraph）**: 通过激活掩码从总图中提取的特定州/地区子图
- **词组单位（Phrase_Unit）**: 替代单词作为网络节点的多词语义单位（英文2-gram，中文分词后短语）
- **动态停词（Dynamic_Stopword）**: 通过TF-IDF等信息量指标自动发现的高频低区分度词组
- **布局稳定性（Layout_Stability）**: 使用确定性算法确保同一节点在不同图中位置一致
- **窗口定义（Window_Definition）**: TOC分段的每个segment作为一个共现窗口
- **激活掩码（Activation_Mask）**: 用于从总图中提取州级子图的节点/边选择机制
- **TOC文档（TOC_Documents）**: 输入的TOC分段JSON文档，包含segment_id/title/level/order/text字段

## 需求

### 需求1：确定性布局与可视化稳定性

**用户故事：** 作为研究人员，我希望获得清晰、稳定、可复现的网络可视化，以便在不同运行环境下得到一致的结果。

#### 验收标准

1. 当生成网络布局时，系统应使用固定随机种子的确定性布局策略
2. 系统应采用力导向布局的稳定变体，并引入层级/社群辅助布局
3. 当处理大规模网络时，系统应根据边权阈值与节点重要性进行可视化过滤
4. 系统应实现节点位置缓存机制，确保同一输入产生一致的图形输出
5. 当显示网络时，系统应根据度、PageRank或TF-IDF权重进行标注策略分层
6. 系统应避免节点大规模重叠，保持可视化的清晰度

### 需求2：总图优先的文件结构

**用户故事：** 作为研究人员，我希望系统先建立总图再按州激活，以便保证跨州对比时指标可比、节点语义空间一致。

#### 验收标准

1. 系统应首先从所有文档构建统一的总图（Global_Graph）
2. 当进行州级分析时，系统应通过激活掩码或诱导子图从总图中提取州级子图
3. 系统应确保总图用于统一词表与节点空间
4. 当生成州级子图时，系统应保持与总图相同的节点位置
5. 系统应显式保留孤立节点以反映缺失或弱连接现象
6. 系统应为每个州/地区生成独立的子图分析结果

### 需求3：词组级节点单位升级

**用户故事：** 作为研究人员，我希望使用词组/短语作为节点单位而非单个词，以便获得更有意义的语义表示。

#### 验收标准

1. 当处理英文文本时，系统应采用2-gram（bigram）作为主要节点候选
2. 系统应结合统计约束（互信息、t-score或凝固度/自由度）筛选高质量短语
3. 当处理中文文本时，系统应采用分词后再进行短语抽取
4. 系统应优先使用NLTK/常规统计方法完成可复现的抽取流程
5. 当需要时，系统应提供LLM工具作为可选增强模块，而非默认依赖
6. 系统应从2-gram起步并可扩展到多词短语

### 需求4：动态停词自动发现机制

**用户故事：** 作为研究人员，我希望系统能自动识别并过滤"口水词/泛化词"，以便提升网络质量和解释性。

#### 验收标准

1. 系统应计算全语料的TF-IDF或类似信息量指标
2. 当识别停词时，系统应发现跨文档普遍高频但区分度极低的词组
3. 系统应形成可解释的动态stopword列表
4. 系统应将动态停词表与人工停词表合并
5. 当构建词表与共现网络时，系统应应用合并后的停词表作为强约束
6. 系统应降低噪声边、提升网络模块结构与解释性

### 需求5：可复现的窗口定义与数据流程

**用户故事：** 作为研究人员，我希望有严格定义的共现窗口和数据处理流程，以便确保结果的可复现性。

#### 验收标准

1. 系统应接受TOC分段输出的JSON作为输入（包含segment_id/title/level/order/text字段）
2. 当定义共现窗口时，系统应将每个segment的text视为一个共现窗口
3. 系统应对英文/中文分别执行规范化、分词/切分、短语抽取、停词过滤
4. 系统应生成统一的节点词表与映射表（phrase → node_id）
5. 当统计共现边时，系统应在所有窗口上计算无向、带权的共现关系
6. 系统应支持按窗口二值共现累加，可扩展为计数型或基于距离衰减的权重

### 需求6：州级子图激活与对比分析

**用户故事：** 作为研究人员，我希望能够进行州级/文档级子图分析和横向对比，以便发现区域差异。

#### 验收标准

1. 当生成州级子图时，系统应通过窗口归属信息进行激活
2. 系统应支持在总图边权上做子集重加权（只累加目标州窗口的共现）
3. 系统应支持从总图结构中提取诱导子图并保留节点位置缓存
4. 当显示不同州图时，系统应确保同一节点在不同州图中位置不变
5. 系统应直接支持横向对比分析
6. 系统应为每个州生成独立的网络统计指标

### 需求7：工程正确性与批处理能力

**用户故事：** 作为研究人员，我希望系统能自动批处理所有文档并输出规范化结果，以便进行大规模分析。

#### 验收标准

1. 系统应对所有toc_doc文件夹可自动批处理
2. 当处理完成时，系统应输出规范化的中间结果
3. 系统应生成清洗后tokens/phrases、动态停词表、词表频次与TF-IDF
4. 系统应输出共现矩阵、边表、图统计等结构化数据
5. 系统应生成可复现图像（含布局缓存）
6. 系统应提供完整的处理日志和错误报告

### 需求8：多维度网络结构对比分析

**用户故事：** 作为研究人员，我希望对比不同设置对网络结构的影响，以便验证方法的有效性。

#### 验收标准

1. 系统应对比"单词节点 vs 词组节点"对网络结构的影响
2. 系统应对比"静态停词 vs 动态停词"的效果差异
3. 系统应对比"总图 vs 州级激活子图"的结构特征
4. 当进行对比分析时，系统应计算节点/边规模、密度、孤立点比例
5. 系统应分析连通分量、聚类系数、平均路径长度、中心性排序稳定性
6. 系统应评估社群划分可解释性和跨州关键主题短语差异

### 需求9：EasyGraph/OpenRank集成准备

**用户故事：** 作为研究人员，我希望系统为后续图融合实验提供可靠的基础，以便进行多视图图分析。

#### 验收标准

1. 当准备图融合时，系统应提供高质量、噪声受控的短语级共现总图
2. 系统应确保节点语义更稳定，作为可靠的基底层（base layer）
3. 系统应支持多视图图（embedding图、共现图、影响力图）在同一节点空间下融合
4. 系统应提供union/consensus/加权融合的数据接口
5. 系统应输出与EasyGraph/OpenRank框架兼容的图数据格式
6. 系统应为图融合策略验证提供可复用的实验设计

### 需求10：可追溯的实验设计与文档

**用户故事：** 作为研究人员，我希望获得完整的实验文档和可追溯的分析过程，以便支持学术发表。

#### 验收标准

1. 系统应形成可直接用于plan document的结构化叙述
2. 当生成文档时，系统应清晰界定输入（TOC分段文本）和核心产出
3. 系统应记录关键技术选择（2-gram/分词、统计短语筛选、动态停词、布局缓存）
4. 系统应说明与比赛要求和前期proposal/ppt的对应关系
5. 系统应提供可追溯的数据清洗与词表生成过程
6. 系统应生成全局图与州级子图的结构指标对比报告